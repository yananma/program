

re.match() 匹配第一个，从开头匹配。  

re.search() 不是从开头匹配，返回第一个符合的。  

re.findall() 返回所有，只有字符，没有位置，没有其他信息。  

re.finditer() 返回迭代器。还有位置。  

只要匹配一个就用 search() 或 match()  

要所有，而且是只要字符串，就用 findall()  

要所有字符串，而且还要位置等信息，就用 finditer()  


### re 模块  

在 Python 中 import re，点进去看注释和源码  

[正则表达式详细文档](https://www.nowcoder.com/tutorial/10005/405978e43980483691016271ac34c9f8)  


.* 表示任意匹配除换行符（\n、\r）之外的任何单个或多个字符  


#### match 函数 

re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match() 就返回 none。  

函数语法：`re.match(pattern, string, flags=0)`  

```python 
In [1]: re.match("www", "www.baidu.com")  # 在起始位置匹配
Out[1]: <re.Match object; span=(0, 3), match='www'>

In [2]: re.match("www", "www.baidu.com").span()
Out[2]: (0, 3)

In [3]: print(re.match("com", "www.baidu.com"))  # 不在起始位置匹配
None
```

#### search 函数

re.search 扫描整个字符串并返回第一个成功的匹配。  

函数语法：`re.search(pattern, string, flags=0)`  

```python 
In [1]: re.search("www", "www.baidu.com")
Out[1]: <re.Match object; span=(0, 3), match='www'>

In [2]: re.search("www", "www.baidu.com").span()
Out[2]: (0, 3)

In [3]: re.search("com", "www.baidu.com").span()
Out[3]: (10, 13)  
```

re.match 只匹配字符串的开始，如果字符串开始不符合正则表达式，则匹配失败，函数返回 None；而 re.search 匹配整个字符串，直到找到一个匹配。  


#### sub 函数  

re=regular expression(正则表达式)，sub=substitute(替换)；  

re.sub是个正则表达式替换函数，用来实现通过正则表达式，实现比普通字符串的replace更加强大的替换功能；    

re.sub(pattern, repl, string, count=0, flags=0)  

pattern：文章里的原词  
repl：就是 replacement，把 pattern 指定的词替换成这里指定的词  
string：文章  
count：替换次数  

re.sub(pattern, repl, string, count=0, flags=0)    
```python
re.sub('中科院', "<TAG country='中国'>中科院</TAG>", '\t这是一个字符串，有中科院这个单词   ')
Out[52]: "\t这是一个字符串，有<TAG country='中国'>中科院</TAG>这个单词   "
```

[re.sub 例子展开](https://github.com/yananma/work/blob/main/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Python%20%E7%A8%8B%E5%BA%8F/Python%20%E4%BB%BB%E5%8A%A1%E7%A8%8B%E5%BA%8F.md#0728)  


#### compile 函数

compile 函数用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 match() 和 search() 这两个函数使用。  

语法格式为：`re.compile(pattern[, flags])`  


#### findall 函数  

```python 
In [9]: re.findall('the', 'the best things are the best.')
Out[9]: ['the', 'the']
```

findall 返回一个列表  

```python 
In [1]: import re

In [2]: RE_WORD = re.compile('\w+')

In [3]: text = 'the trick william Potter is not minding that it hurts.'

In [4]: RE_WORD.findall(text)
Out[4]: 
['the',
 'trick',
 'william',
 'Potter',
 'is',
 'not',
 'minding',
 'that',
 'it',
 'hurts']

In [7]: text = 'the best things are the best.'

In [8]: RE_WORD.findall(text)
Out[8]: ['the', 'best', 'things', 'are', 'the', 'best']
```


#### finditer 函数  

坐标元组：item.span()    
坐标开始：item.start()  
坐标结束：item.end()   
匹配文字：item.group()   


查找 keyword_idx  

```python 
In [107]: re.finditer(r"(byd|比亚迪)", "比亚迪的名字是简称byd")
Out[107]: <callable_iterator at 0x7f7c39b222d0>

In [108]: for item in re.finditer(r"(byd|比亚迪)", "比亚迪的名字是简称byd"):
     ...:     print(item)
     ...: 
<re.Match object; span=(0, 3), match='比亚迪'>
<re.Match object; span=(9, 12), match='byd'>

In [111]: for item in re.finditer(r"(byd|比亚迪)", "比亚迪的名字是简称byd"):
     ...:     print(list(item.span()))
     ...: 
[0, 3]
[9, 12]
```

```python 
In [10]: re.finditer('the', 'the best things are the best.')
Out[10]: <callable_iterator at 0x7f7cea8b09d0>

In [11]: it = re.finditer('the', 'the best things are the best.')

In [12]: print(next(it))
<re.Match object; span=(0, 3), match='the'>

In [13]: print(next(it))
<re.Match object; span=(20, 23), match='the'>

In [14]: print(next(it))
---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)
<ipython-input-14-4d0222393be1> in <module>
----> 1 print(next(it))

StopIteration: 
```

# 实际例子   

### 匹配 url  

```python 
In [1]: import re

In [2]: s = "2022-06-11 20:30:36,556 - INFO - {'url': u'http://www.iesdouyin.com/share/video/7107858239643045124', 'site_id': '625400', 'verified_reason': '', 'author_id': 'MS4wLjABAAAA_oP3ZGE6cs70YGJOqxfDqCnLi6SVBiObOoPQCDg9kG4', 'fans
   ...: _num': 1190, 'is_verified': 0, 'is_cleaned': True}"

In [3]: re.search('http:(.*?)\'', s).group()[:-1]
Out[3]: 'http://www.iesdouyin.com/share/video/7107858239643045124'
```   

### 多个连续的空行换成一个空行   

```python 
In [22]: s = "第一段\n\n\n\n\n第二段"

In [23]: s
Out[23]: '第一段\n\n\n\n\n第二段'

In [24]: import re

In [25]: s = "第一段\n\n\n\n\n第二段"

In [26]: s
Out[26]: '第一段\n\n\n\n\n第二段'

In [27]: re.sub('\n+', '\n', s)
Out[27]: '第一段\n第二段'
``` 


文本无所不在，所以正则表达式的应用范围非常广泛；正则表达式是非常强大的，可以被反复使用的工具；正则表达式的解决方案相比于其他的方案是最简单的  

图像展示：https://regexper.com/  

https://regex101.com/  

中文教程：https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md  

菜鸟教程表格：https://www.runoob.com/regexp/regexp-syntax.html  

知乎回答：https://www.zhihu.com/question/48219401  


可以把长的正则表达式拆分成一个一个小的片段  

`[]` 表示字符集，从里面包含的范围中取 `[a-z]` 小写，`[A-Z]` 大写，`[tcp]` 字母 t、c、p 中的任意一个，`[0-9]` 数字，`[^]`取否定  
`{}` 表示个数 `{3,15}`，3 到 15 个字符  
`^` 匹配开头  
`$` 匹配结尾  
`.` 任意单个字符`等价于{1}`  
`*` 意思是可选的任意多的 等价于 `等价于{0,}`, `[a-z]*` 没有或任意小写字母开头的字符串。`runo*b，可以匹配 runb、runoob、runoooooob 等`  
`.*` 可以匹配所有字符串  
`+` + 前面的那个字符可以出现一次或多次 positive 等价于 `{1,}`  `runo+b，可以匹配 runoob、runooob、runoooooob 等`   
`?` 表示可选，0 次或 1 次，等价于 `{0,1}`，出现不出现都可以。`colou?r 可以匹配 color 或者 colour`    
`|` 或运算符  
`\w` 匹配字母、数字、下划线。等价于 \[a-zA-Z0-9_]，这是非常常见的组合，文件名，变量名    
`\d` digit 匹配一个数字字符。等价于 \[0-9]，`\d+` 表示一个或多个数字    
`\D` 等价于 \[^0-9]    
`\s` 匹配空白符 s space  


正则表达式匹配总是有多种不同的解决办法，选择自己最熟悉的  
正则表达式区分大小写  



